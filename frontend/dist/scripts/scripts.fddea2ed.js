"use strict";angular.module("trignosourceApp",["ngMaterial","ui.router"]).config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","$httpProvider",function(e,t,a,o){console.log("Start of Config"),a.theme("success-toast"),a.theme("error-toast"),o.interceptors.push("tokenInterceptor"),t.otherwise("/dashboard"),e.state("login",{url:"/login",controller:"AdminLoginCtrl",templateUrl:"views/admin/login.html"}).state("dashboard",{url:"/dashboard",controller:"AdminDashboardCtrl",templateUrl:"views/admin/newDashboard.html",resolve:{checkToken:["$q",function(e){let t=e.defer();return localStorage.getItem("token")?t.resolve():t.reject("token_expired"),t.promise}]}}).state("dashboard.tutorials",{url:"",controller:"AllTutorialsCtrl",templateUrl:"views/admin/all_tutorials.html"}).state("dashboard.chapters",{url:"",controller:"AllChaptersCtrl",templateUrl:"views/admin/all_chapters.html"}).state("dashboard.videos",{url:"",controller:"AllVideosCtrl",templateUrl:"views/admin/all_videos.html"}).state("dashboard.questions",{url:"",controller:"AllQuestionsCtrl",templateUrl:"views/admin/all_questions.html"}).state("dashboard.options",{url:"",controller:"AllOptionsCtrl",templateUrl:"views/admin/all_options.html"})}]).run(["$location","$rootScope","$state","$window",function(e,t,a,o){console.log("Inside Run"),t.$on("token_expired",function(){a.go("login")}),t.$on("$stateChangeError",(e,t,o,r,s,i)=>{a.go("login")})}]),angular.module("trignosourceApp").controller("AdminLoginCtrl",["$scope","$state","Login","Toast",function(e,t,a,o){localStorage.removeItem("token"),e.login={username:"",password:""},e.adminLogin=(()=>{a.adminLogin(e.login).then(e=>{e.data.status?(localStorage.setItem("token",e.data.data.token),t.go("dashboard.tutorials")):o.showError(e.data.message)})})}]),angular.module("trignosourceApp").controller("AdminDashboardCtrl",["$scope","$state","$rootScope","Login","Videos","Toast",function(e,t,a,o,r,s){function i(){document.getElementById("addtutorials").style.display="none",document.getElementById("addchapters").style.display="none",document.getElementById("addvideos").style.display="none",document.getElementById("addquestions").style.display="none",document.getElementById("addoptions").style.display="none"}localStorage.activeTab?(t.go("dashboard."+localStorage.activeTab),a.activeTab=localStorage.activeTab):(localStorage.activeTab="tutorials",t.go("dashboard."+localStorage.activeTab),a.activeTab=localStorage.activeTab),e.Videos=r,e.adminLogout=(()=>{o.adminLogout().then(e=>{e.data.status?(localStorage.removeItem("token"),t.go("login")):s.showError(e.data.message)})}),e.createTutorial=function(){r.create_tutorial.subject_number&&r.create_tutorial.subject_name?r.createTutorial().then(e=>{r.create_tutorial={subject_number:null,subject_name:null},e.data.status?(r.all_tutorials=e.data.data,s.showSuccess("Tutorial created successfully")):s.showError(e.data.message)}):s.showError("Invalid Input")},e.createChapter=function(){r.create_chapter.chapter_number&&r.create_chapter.chapter_name?r.createChapter().then(e=>{r.create_chapter.chapter_number=null,r.create_chapter.chapter_name=null,e.data.status?(r.all_tutorials=e.data.data,s.showSuccess("Chapter created successfully")):s.showError(e.data.message)}):s.showError("Invalid Input")},e.createQuestion=function(){r.create_question.question_number&&r.create_question.question_name&&r.create_question.time_of_pause&&r.create_question.appear_time?r.createQuestion().then(e=>{r.create_question.question_number=null,r.create_question.question_name=null,r.create_question.time_of_pause=null,r.create_question.appear_time=null,e.data.status?(r.all_tutorials=e.data.data,s.showSuccess("Question created successfully")):s.showError(e.data.message)}):s.showError("Invalid Input")},e.createOption=function(){r.create_option.option_number&&r.create_option.option_name&&r.create_option.skip_time?r.createOption().then(e=>{r.create_option.option_number=null,r.create_option.option_name=null,r.create_option.skip_time=null,e.data.status?(r.all_tutorials=e.data.data,s.showSuccess("Option created successfully")):s.showError(e.data.message)}):s.showError("Invalid Input")},i(),document.getElementById("addtutorials").style.display="block",e.changeMenu=function(e){i(),document.getElementById(e).style.display="block"}}]),angular.module("trignosourceApp").controller("addVideosCtrl",["$scope","Videos",function(e,t){e.Videos=t}]),angular.module("trignosourceApp").controller("editVideosCtrl",["$scope","Videos",function(e,t){e.Videos=t}]),angular.module("trignosourceApp").controller("AllTutorialsCtrl",["$scope","$rootScope","$state","Videos","Toast",function(e,t,a,o,r){e.Videos=o,localStorage.activeTab="tutorials",t.activeTab=localStorage.activeTab,o.create_chapter.subject_number=null,o.create_video.subject_number=null,o.create_question.subject_number=null,o.create_option.subject_number=null,e.gotoChapters=function(e){localStorage.currentSubject=e,a.go("dashboard.chapters")},e.deleteTutorial=function(e){o.deleteTutorial(e).then(e=>{e.data.status?(o.all_tutorials=e.data.data,r.showSuccess("Tutorial deleted successfully")):r.showError(e.data.message)})}}]),angular.module("trignosourceApp").controller("AllChaptersCtrl",["$scope","$rootScope","$state","Videos","Toast",function(e,t,a,o,r){e.Videos=o,localStorage.activeTab="chapters",t.activeTab=localStorage.activeTab,e.currentSubject=localStorage.currentSubject,o.create_chapter.subject_number=o.all_tutorials[e.currentSubject].subject_number,o.create_video.subject_number=o.all_tutorials[e.currentSubject].subject_number,o.create_video.chapter_number=null,o.create_question.chapter_number=null,o.create_option.chapter_number=null,e.gotoVideos=function(e){localStorage.currentChapter=e,a.go("dashboard.videos")},e.deleteChapter=function(t){o.deleteChapter(e.currentSubject,t).then(e=>{e.data.status?(o.all_tutorials=e.data.data,r.showSuccess("Chapter deleted successfully")):r.showError(e.data.message)})}}]),angular.module("trignosourceApp").controller("AllVideosCtrl",["$scope","$state","$rootScope","Videos","Toast","$timeout",function(e,t,a,o,r,s){e.Videos=o,localStorage.activeTab="videos",a.activeTab=localStorage.activeTab,e.currentSubject=localStorage.currentSubject,e.currentChapter=localStorage.currentChapter,o.create_video.subject_number=o.all_tutorials[e.currentSubject].subject_number,o.create_video.chapter_number=o.all_tutorials[e.currentSubject].chapters[e.currentChapter].chapter_number,o.create_question.video_number=null,o.create_option.video_number=null,e.gotoQuestions=function(e){localStorage.currentVideo=e,t.go("dashboard.questions")},e.deleteVideo=function(t){o.deleteVideo(e.currentSubject,e.currentChapter,t).then(e=>{e.data.status?(s(function(){o.all_tutorials=e.data.data}),r.showSuccess("Video deleted successfully")):r.showError(e.data.message)})}}]),angular.module("trignosourceApp").controller("AddTutorialCtrl",["$scope","$rootScope","$state","Videos",function(e,t,a,o){e.Videos=o,localStorage.activeRightTab="tutorials",t.activeRightTab=localStorage.activeTab}]),angular.module("trignosourceApp").controller("AllQuestionsCtrl",["$scope","$state","$rootScope","Videos","Toast","$timeout",function(e,t,a,o,r,s){e.Videos=o,localStorage.activeTab="questions",a.activeTab=localStorage.activeTab,e.currentSubject=localStorage.currentSubject,e.currentChapter=localStorage.currentChapter,e.currentVideo=localStorage.currentVideo,o.create_question.subject_number=o.all_tutorials[e.currentSubject].subject_number,o.create_question.chapter_number=o.all_tutorials[e.currentSubject].chapters[e.currentChapter].chapter_number,o.create_question.video_number=o.all_tutorials[e.currentSubject].chapters[e.currentChapter].videos[e.currentVideo].video_number,o.create_option.question_number=null,e.gotoOptions=function(e){localStorage.currentQuestion=e,t.go("dashboard.options")},e.deleteQuestion=function(t){o.deleteQuestion(e.currentSubject,e.currentChapter,e.currentVideo,t).then(e=>{e.data.status?(s(function(){o.all_tutorials=e.data.data}),r.showSuccess("Question deleted successfully")):r.showError(e.data.message)})}}]),angular.module("trignosourceApp").controller("AllOptionsCtrl",["$scope","$rootScope","Videos","Toast","$timeout",function(e,t,a,o,r){e.Videos=a,localStorage.activeTab="options",t.activeTab=localStorage.activeTab,e.currentSubject=localStorage.currentSubject,e.currentChapter=localStorage.currentChapter,e.currentVideo=localStorage.currentVideo,e.currentQuestion=localStorage.currentQuestion,a.create_option.subject_number=a.all_tutorials[e.currentSubject].subject_number,a.create_option.chapter_number=a.all_tutorials[e.currentSubject].chapters[e.currentChapter].chapter_number,a.create_option.video_number=a.all_tutorials[e.currentSubject].chapters[e.currentChapter].videos[e.currentVideo].video_number,a.create_option.question_number=a.all_tutorials[e.currentSubject].chapters[e.currentChapter].videos[e.currentVideo].questions[e.currentQuestion].question_number,e.deleteOption=function(t){a.deleteOption(e.currentSubject,e.currentChapter,e.currentVideo,e.currentQuestion,t).then(e=>{e.data.status?(r(function(){a.all_tutorials=e.data.data}),o.showSuccess("Option deleted successfully")):o.showError(e.data.message)})}}]),angular.module("trignosourceApp").factory("tokenInterceptor",["$q","$rootScope",function(e,t){return{request:function(t){t.headers=t.headers||{};let a=localStorage.getItem("token");return a&&(t.headers.Authorization=a),t||e.when(t)},responseError:function(a){return 401===a.status?t.$broadcast("tokenexpired"):502!=a.status&&500!=a.status||t.$broadcast("reloadpage"),a||e.when(a)}}}]);class Toast{constructor(e){this.$mdToast=e}showSuccess(e){this.$mdToast.show(this.$mdToast.simple().textContent(e).hideDelay(3e3).position("top center").theme("success-toast"))}showError(e){this.$mdToast.show(this.$mdToast.simple().textContent(e).hideDelay(3e3).position("top center").theme("error-toast"))}}Toast.$inject=["$mdToast"],angular.module("trignosourceApp").service("Toast",Toast);class Login{constructor(e){this.$http=e}adminLogin(e){return this.$http({url:"/api/admin/login",method:"POST",data:e})}adminLogout(){return this.$http({url:"/api/admin/logout",method:"POST"})}}Login.$inject=["$http"],angular.module("trignosourceApp").service("Login",Login);class Videos{constructor(e,t,a){this.$http=e,this.$timeout=t,this.Toast=a,this.validFormats=["pdf","xls","xlsx","zip","rar","gz","txt","rtf","jpg","jpeg","png","gif","bmp","html","tiff","tar.gz","gzip","docx","doc","mp4","m4v"],this.video_name=null,this.all_videos=[],this.all_tutorials=[],this.getAllTutorials(),this.getAllVideos(),this.FileMessage=null,this.durationError=null,this.create_tutorial={subject_number:null,subject_name:null},this.create_chapter={chapter_number:null,subject_number:null,chapter_name:null},this.create_video={chapter_number:null,subject_number:null,video_name:null,video_number:null,thumbnail_time:null},this.create_question={chapter_number:null,subject_number:null,video_number:null,question_number:null,question_name:null,time_of_pause:null,appear_time:null},this.create_option={chapter_number:null,subject_number:null,video_number:null,question_number:null,option_number:null,option_name:null,skip_time:null}}getAllTutorials(){this.$http({url:"/api/admin/tutorials",method:"GET"}).then(e=>{e.data.status?this.all_tutorials=e.data.data:this.Toast.showError(e.data.message)})}createTutorial(){return this.$http({url:"/api/admin/tutorials",method:"POST",data:this.create_tutorial})}createChapter(){return this.$http({url:"/api/admin/chapters",method:"POST",data:this.create_chapter})}createQuestion(){return this.$http({url:"/api/admin/questions",method:"POST",data:this.create_question})}createOption(){return this.$http({url:"/api/admin/options",method:"POST",data:this.create_option})}deleteTutorial(e){return this.$http({url:`/api/admin/tutorials?subject_number=${this.all_tutorials[e].subject_number}`,method:"DELETE"})}deleteVideo(e,t,a){let o=`/api/admin/videos?subject_number=${this.all_tutorials[e].subject_number}`;return o+=`&chapter_number=${this.all_tutorials[e].chapters[t].chapter_number}`,o+=`&video_number=${this.all_tutorials[e].chapters[t].videos[a].video_number}`,this.$http({url:o,method:"DELETE"})}deleteQuestion(e,t,a,o){let r=`/api/admin/questions?subject_number=${this.all_tutorials[e].subject_number}`;return r+=`&chapter_number=${this.all_tutorials[e].chapters[t].chapter_number}`,r+=`&video_number=${this.all_tutorials[e].chapters[t].videos[a].video_number}`,r+=`&question_number=${this.all_tutorials[e].chapters[t].videos[a].questions[o].question_number}`,this.$http({url:r,method:"DELETE"})}deleteOption(e,t,a,o,r){let s=`/api/admin/options?subject_number=${this.all_tutorials[e].subject_number}`;return s+=`&chapter_number=${this.all_tutorials[e].chapters[t].chapter_number}`,s+=`&video_number=${this.all_tutorials[e].chapters[t].videos[a].video_number}`,s+=`&question_number=${this.all_tutorials[e].chapters[t].videos[a].questions[o].question_number}`,s+=`&option_number=${this.all_tutorials[e].chapters[t].videos[a].questions[o].options[r].option_number}`,this.$http({url:s,method:"DELETE"})}deleteChapter(e,t){return this.$http({url:`/api/admin/chapters?subject_number=${this.all_tutorials[e].subject_number}&chapter_number=${this.all_tutorials[e].chapters[t].chapter_number}`,method:"DELETE"})}getAllVideos(){this.$http({url:"/api/admin/upload",method:"GET"}).then(e=>{e.data.status?this.all_videos=e.data.data:this.Toast.showError(e.data.message)})}validateVideoName(){this.create_video.video_name&&this.create_video.video_number&&this.create_video.thumbnail_time?(this.FileMessage=null,this.enableUpload=this.checkThumbnailTime()):this.enableUpload=!1}addDuration(){this.edit_video.pause_durations.push("00:00:00"),this.edit_video.questions.push({appear_time:"00:00:00",question_text:"",options:[]}),this.checkDuration()}addOptions(e){this.edit_video.questions[e].options.push({skip_time:"00:00:00",text:""}),console.log(this.edit_video),this.checkDuration()}removeOptions(e,t){console.log(e,t),this.edit_video.questions[e].options.splice(t,1),this.checkDuration()}removeDuration(e){this.edit_video.pause_durations.splice(e,1),this.edit_video.questions.splice(e,1),this.checkDuration()}checkThumbnailTime(){var e=this.create_video.thumbnail_time.split(":");return console.log(e,e.length),3==e.length}checkDuration(){this.durationError=null,_.each(this.edit_video.pause_durations,e=>{console.log(e);var t=e.split(":");console.log(t,t.length),3!=t.length&&(this.durationError="Duration should be of the format HH:MM:SS")}),_.each(this.edit_video.questions,e=>{3!=e.appear_time.split(":").length?this.durationError="Appear Time should be of the format HH:MM:SS":_.each(e.options,e=>{3!=e.skip_time.split(":").length&&(this.durationError="Stop Time should be of the format HH:MM:SS")})})}editUpload(e){this.edit_video=this.all_videos[e],$("#editVideos").modal("show")}editUploadSubmit(){this.$http({url:"/api/admin/upload",method:"PUT",data:this.edit_video}).then(e=>{e.data.status?(this.Toast.showSuccess(e.data.message),this.getAllVideos()):this.Toast.showError(e.data.message)})}deleteUpload(e){let t=this.all_videos[e].id;this.$http({url:`/api/admin/upload?id=${t}`,method:"DELETE"}).then(e=>{e.data.status?(this.Toast.showSuccess(e.data.message),this.getAllVideos()):this.Toast.showError(e.data.message)})}uploadFileVideo(e){this.temp_element=e,console.log(this.temp_element),this.validateVideoName()}uploadSubmit(){this.uploadFile(this.temp_element)}uploadFile(e){this.validateVideoName(),this.enableUpload?this.$timeout(()=>{this.enableUpload=!1,this.theFile=e.files[0],this.FileMessage=null;var t=this.theFile.name.split(".").pop(),a=-1!==this.validFormats.indexOf(t),o=1==e.files.length,r=this.theFile.name.length<=64;if(a&&o&&r){var s=new FormData;s.append("file",this.theFile);let e=`/api/admin/upload?video_name=${this.create_video.video_name}`;e+=`&subject_number=${this.create_video.subject_number}`,e+=`&chapter_number=${this.create_video.chapter_number}`,e+=`&video_number=${this.create_video.video_number}`,e+=`&thumbnail_time=${this.create_video.thumbnail_time}`,this.$http({url:e,method:"POST",headers:{"Content-Type":void 0},data:s}).then(e=>{e.data.status?(this.all_tutorials=e.data.data,this.create_video.video_name=null,this.create_video.video_number=null,this.create_video.thumbnail_time=null,this.enableUpload=!1,this.Toast.showSuccess("Video created successfully")):this.Toast.showError("Something went wrong! Please try again")}).catch(()=>{this.Toast.showError("Something went wrong while uploading")}),angular.element("input[type='file']").val(null)}else a?o?r||(this.theFile="",angular.element("input[type='file']").val(null),this.FileMessage="Filename cannot exceed 64 Characters"):(this.theFile="",angular.element("input[type='file']").val(null),this.FileMessage="Cannot upload more than one file at a time"):(this.theFile="",angular.element("input[type='file']").val(null),this.FileMessage="Please upload correct File Name, File extension is not supported")}):this.Toast.showError("Please fill in proper details")}}Videos.$inject=["$http","$timeout","Toast"],angular.module("trignosourceApp").service("Videos",Videos);